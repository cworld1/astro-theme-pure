---
import { changelogEntries } from '@/data/changelog'
import { languages, useTranslations } from '@/i18n/ui'

import type { TimelineEvent } from 'astro-pure/types'
import { Timeline } from 'astro-pure/user'
import PageLayout from '@/layouts/CommonPage.astro'

export const prerender = true

export async function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({ params: { lang } }))
}

const { lang } = Astro.params
const t = useTranslations(lang as any)

// æ ¹æ®å½“å‰è¯­è¨€è½¬æ¢ changelog æ•°æ®ä¸º Timeline ç»„ä»¶æ‰€éœ€æ ¼å¼
const timelineEvents: TimelineEvent[] = changelogEntries.map((entry) => ({
  date: entry.date,
  content: lang === 'zh' ? entry.zh : entry.en
}))

// é¡µé¢ç›®å½•ï¼ˆå¯é€‰ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼‰
const headings = [{ depth: 2, slug: 'all-updates', text: t('changelog.all_updates') }]
---

<PageLayout title={t('changelog.title')} {headings}>
  <div class='changelog-intro mb-8'>
    <p class='text-lg text-muted-foreground'>
      {t('changelog.intro')}
    </p>
  </div>

  <h2 id='all-updates' class='mb-6 text-2xl font-bold'>
    {t('changelog.all_updates')}
  </h2>

  <Timeline events={timelineEvents} class='changelog-timeline' />

  <div class='mt-12 rounded-lg border border-border bg-card/50 p-6 backdrop-blur-sm'>
    <h3 class='mb-3 text-lg font-semibold'>
      {lang === 'zh' ? 'ğŸ“ å¦‚ä½•æ·»åŠ æ–°çš„æ›´æ–°æ¡ç›®ï¼Ÿ' : 'ğŸ“ How to Add New Updates?'}
    </h3>
    <p class='mb-3 text-sm text-muted-foreground'>
      {
        lang === 'zh'
          ? 'ç¼–è¾‘ä»¥ä¸‹æ–‡ä»¶å³å¯æ·»åŠ æ–°çš„æ›´æ–°æ¡ç›®ï¼š'
          : 'Edit the following file to add new changelog entries:'
      }
    </p>
    <code class='block rounded bg-muted px-3 py-2 text-sm'> src/data/changelog.ts </code>
    <p class='mt-3 text-sm text-muted-foreground'>
      {
        lang === 'zh'
          ? 'åœ¨æ•°ç»„æœ€å‰é¢æ·»åŠ æ–°æ¡ç›®ï¼Œä¿å­˜æ–‡ä»¶åé¡µé¢ä¼šè‡ªåŠ¨æ›´æ–°ã€‚'
          : 'Add new entries at the beginning of the array, the page will update automatically after saving.'
      }
    </p>
  </div>
</PageLayout>

<style>
  .changelog-timeline {
    @apply max-w-4xl;
  }

  .changelog-intro p {
    @apply leading-relaxed;
  }
</style>
